<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>musci_search</title>
    <script src="../../../common/base_stylesheet.js"></script>
    <script src="../../../common/base_javascript.js"></script>
</head>
<body>
<div id="app">
    <el-input v-model="musciname" placeholder="请输歌曲名称" style="width:240px"></el-input>
    <el-button type="primary" @click="search" v-loading.fullscreen.lock="fullscreenLoading">搜索</el-button>
    <template>
        <el-table
                :data="datalist"
                style="width: 100%">
            <el-table-column
                    type="index"
                    label="序号"
                    :index="indexMethod">
            </el-table-column>
            <el-table-column
                    prop="musicname"
                    label="歌曲名"
                    width="280">
            </el-table-column>
            <el-table-column
                    prop="author"
                    label="歌手"
                    width="280">
            </el-table-column>
            <el-table-column
                    prop="album"
                    label="收录专辑">
            </el-table-column>
            <el-table-column
                    prop="time"
                    label="歌曲时常">
            </el-table-column>
            <el-table-column label="操作"  width="200">
                <template slot-scope="scope">
                    <el-button
                            size="mini"
                            @click="handleEdit(scope.$index, scope.row)">查看详情</el-button>
                </template>
            </el-table-column>
        </el-table>
    </template>
</div>
<script>
    var tableData = {datalist: [],musciname:"",fullscreenLoading: false};
    var dataurl = GetRootPath()+"spider/music/searchwithname";
    new Vue({
        el: '#app',
        data:tableData,
        methods: {

            handleEdit(index, row) {
                OpenDialog("editdialog","查看评论","pages/spider/music/music_detail.html?url="+row.url,600,1200,afterClose);
            },
            search:function () {
                loadata(tableData.musciname);
            },
            indexMethod(index) {
                return index + 1;
            }
        }
    })

    function afterClose() {

    }

    //post提交，data要使用JSON.stringify进行转换，否则会作为get方法的数据跟在url后传递过去
    function loadata(musciname) {
        Vue.set(tableData,"fullscreenLoading",true);
        $.ajax({
            type: "POST",
            url: dataurl,
            contentType: "application/json;charset=uft-8",
            data: JSON.stringify({"musciname":musciname}),
            dataType : "json",
            complete: function (data, status) {
                Vue.set(tableData,"datalist",JSON.parse(data.responseText).datalist);
                Vue.set(tableData,"fullscreenLoading",false);
            }
        })
    }
</script>
</body>
</html>